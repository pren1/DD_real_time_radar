"""
usage: add this 2 lines in MongoDB.py and run:
	with open(POSITION_OF_THIS_FILE+"update01.py","r") as f: 
		exec(f.read())

fix the issue that some people are thought of interpretation man by judgement process incorrectly.(About 50%)
Now their threshord (number of danmaku of being thought of interpretation man) are resetted.

fix the indexes created incorrectly.

2020-03-07 by scPointer
"""
from tqdm import tqdm
list3000 = [2101875, 6646350, 4136273, 2002793, 209600, 13095354, 102440493, 315601837, 12571960, 1454911, 78121, 241880, 104189900, 9304715, 6379369, 28789487, 7988214, 13791309, 9347814, 243647396, 6883917, 40190863, 14841978, 502831, 124177, 89031628, 12400225, 17423600, 224839539, 6764986, 11360955, 31324294, 87712480, 1295786, 60160, 15869232, 262515519, 106352232, 40850159, 28573315, 5571625, 204965, 1924849, 16530007, 2240476, 10291126, 20661450, 281667916, 131441910, 11068896, 82463104, 11990924, 92860973, 94879293, 18102639, 32724937, 38418326, 4470920, 3812308, 65888518, 37885178, 14397053, 3430526, 10513609, 2896284, 86742899, 2574615, 323069577, 430240977, 8750978, 4924350, 23425502, 35122106, 87650753, 9074887, 129212428, 15408064, 35992508, 732209, 9142921, 26658863, 11235461, 25115, 10290745, 32489815, 107414575, 10316221, 10744225, 10897952, 10120598, 90566, 199928457, 565234, 30591938, 406740, 4669744, 1791924, 1346629, 7862155, 3769058, 25844076, 307214, 288011335, 877494, 3782373, 16398091, 171919, 14940652, 1969513, 328477, 39566046, 15530775, 66963911, 24412020, 26897743, 11141451, 316527470, 1969714, 33178167, 336800070, 20382458, 19184692, 74928521, 174389285, 2321450, 4381806, 3885523, 128695219, 265286, 2224172, 81445, 381768785, 30788492, 288678812, 10732648, 4127894, 13223029, 62578890, 412154154, 252686, 297548007, 50423066, 10506699, 45465019, 909894, 34329323, 7955022, 89527762, 122376999, 223853887, 457960304, 59119242, 26480472, 74839515, 12220220, 404210253, 11171420, 147161813, 450337, 12535027, 38608128, 272476128, 13198765, 12284238, 400823571, 14501198, 154223702, 435716747, 217630, 173473304, 3987649, 3403985, 201352262, 203908511, 5423488, 116791, 43792813, 621480, 12582185, 797815, 312846364, 2850599, 5210395, 12355711, 15491953, 174498554, 17704251, 688115, 350258271, 287954411, 68488, 3944017, 1831605, 13352546, 3592080, 448838492, 3448258, 31377253, 33010238, 14540753, 476317702, 4252047, 287724687, 35959116, 633453, 6768778, 160057770, 3274135, 157477086, 150624605, 4212765, 348419905, 3193602, 345594700, 8168248, 1728860, 135564302, 113691918, 3351, 4265321, 5442495, 36266865, 288153206, 11288564, 5132133, 354200415, 290418794, 24139, 27973156, 14367824, 85621911, 25545233, 258568438, 16250456, 5309534, 128912828, 8999616, 13739628, 3794592, 194366767, 181345, 1707932, 156926, 3017149, 393786168, 29274472, 76553481, 361174583, 5398196, 455008556, 400683195, 40861772, 399914634, 442030310, 4293559, 344908333, 27722617, 319722620, 56325739, 378058525, 498604787, 385339683, 100574659, 90168030, 97209097, 11635592, 255815989, 20807305, 199152384, 12584335, 39497395, 43250273, 7370593, 2148784, 8337466, 10360156, 3369480, 91713928, 24574895, 413607, 17364887, 4245686, 431226, 11746119, 308641432, 845908, 37397751, 7080271, 94253282, 186631502, 438499030, 107829905, 38892302, 94797534, 862551, 34678213, 13046477, 1623825, 437036846, 346288192, 10899372, 6396931, 54770471, 274685665, 12914884, 3788826, 438747939, 36801165, 355132454, 362455192, 28464598, 29623336, 24159939, 25280731, 448860338, 163836777, 183383348, 13090484, 429701676, 15117756, 7598236, 4164913, 9309167, 9280756, 474445146, 6379095, 66714481, 5591358, 61464415, 393797357, 1707276, 454815891, 2231220, 3149619, 10944308, 105010465, 23210743, 456261043, 22496901, 76090342, 13068490, 130805844, 10469283, 3698864, 37379039, 389562837, 20620285, 23309677, 426489, 38504413, 626951, 7342044, 345945452, 291251031, 444470439, 60076424, 26924, 343933024, 20279358, 13061006, 14891473, 5823485, 688239, 768630, 5083849, 211194922, 21918890, 8538665, 95105897, 37988803, 70931749, 290297, 9316207, 32948377, 454362540, 10162372, 100855210, 281319, 44641701, 37692120, 304658031]
list1000 = [440548446, 3418188, 12754778, 7360511, 1428494, 4271984, 13742821, 724968]
list10000 = [2377732, 27620820, 30862279, 164773263, 32411437, 391565955, 183689, 5760513, 3124215]
db.reset_threshord_of(list1000,1000)
db.reset_threshord_of(list3000,3000)
db.reset_threshord_of(list10000,10000)
db.mid_info.create_index([('danmaku_count',-1)])
db.mid_info.create_index([('danmaku_len_count',-1)])
info = list(db.mid_info.find())
for man in tqdm(info):
	if man['danmaku_count'] >= man['danmaku_threshord']:
			its_table = db.mydb[MID_TABLE_OF + str(man['_id'])]
			its_table.drop_index('roomid_1_timestamp_1')
			its_table.create_index([('roomid',1)])
			its_table.create_index([('timestamp',-1)])

info = list(db.roomid_info.find())
for room in tqdm(info):
	its_table = db.mydb[ROOM_TABLE_OF+str(room['_id'])]
	its_table.drop_index('mid_1_timestamp_1')
	its_table.create_index([('mid',1)])
	its_table.create_index([('timestamp',-1)])